import { NetInfo } from 'react-native';

export default function netInfo( cb ){
    function handleFirstConnectivityChange(isConnected) {
        console.log('Then, is ' + (isConnected ? 'online' : 'offline'));
        NetInfo.isConnected.removeEventListener(
            'change',
            handleFirstConnectivityChange
        );

        NetInfo.isConnected.fetch().then(ifConnected => {
            // console.log('First, is ' + (ifConnected ? 'online' : 'offline'));
            Config.netInfo.isConnected = ifConnected ? 'online' : 'offline';
            if (ifConnected){
                if (_.isFunction(cb)){
                    cb()
                }
            }
            else {
                Toast.show('网络不可用')
            }
        });

        NetInfo.fetch().done((reach) => {
            // console.log('Initial: ' + reach);
            Config.netInfo.type = reach;
        })
    }

    NetInfo.isConnected.addEventListener(
        'change',
        handleFirstConnectivityChange
    );
}
