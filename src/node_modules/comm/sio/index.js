window.navigator.userAgent = 'react-native';
// if (window && window.navigator && Object.keys(window.navigator).length == 0) {
//   window = Object.assign(window, { navigator: { userAgent: 'ReactNative' }});
// }
// let isAndroid = /Android/i.test(navigator.userAgent);

// import io from 'socket.io-client/socket.io';
import io from 'react-native-socket.io-client';

let ws_config = {
    jsonp: false,
    transports: ['websocket']
}
let ids = {};
let instance;

function _sio(url, cb){
    if (!url){
        if (!instance){
            let socket = io(Config.socketIo.domain, ws_config);
            socket.on('connect', function () {
                instance = socket;
                if (typeof cb==='function'){
                    cb.call(null, socket)
                }
            });
        }
        else {
            cb.call(null, instance)
        }
    }
    else {
        let socket = io(url, ws_config);
        socket.on('connect', function () {
            if (typeof cb==='function'){
                cb.call(null, socket)
            }
        });
    }
}

export default function sio(url, cb){
    if (typeof url==='function'){
        cb = url;
        _sio(undefined, cb);
    }
    else {
        _sio(url, cb)
    }
}






// let ws = new WebSocket('ws://www.agzgz.com/imchat');
//
// export default function(){
//     console.log(ws);
//     ws.onopen = () => {
//       // connection opened
//
//       ws.send('hi'); // send a message
//     };
//
//     ws.onmessage = (e) => {
//       // a message was received
//       console.log(e.data);
//     };
//
//     ws.onerror = (e) => {
//       // an error occurred
//       console.log(e.message);
//     };
//
//     ws.onclose = (e) => {
//       // connection closed
//       console.log(e.code, e.reason);
//     };
//
// }
